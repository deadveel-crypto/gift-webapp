<!DOCTYPE html><html lang="ru"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> <title>Divine Case</title> <script src="https://telegram.org/js/telegram-web-app.js"></script> <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Orbitron:wght@500;700;900&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet"> <style> * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; } :root { --bg-primary: #05050a; --bg-secondary: #0a0a14; --accent-gold: #fbbf24; --accent-purple: #6366f1; --accent-purple-light: #818cf8; --accent-pink: #ec4899; --accent-aqua: #22d3ee; --text-primary: #ffffff; --text-secondary: #71717a; --border-color: rgba(99, 102, 241, 0.12); --theme-color: #6366f1; --theme-color-light: #818cf8; --theme-glow: rgba(99, 102, 241, 0.5); } body { background: var(--bg-primary); min-height: 100vh; display: flex; flex-direction: column; align-items: center; color: var(--text-primary); overflow-x: hidden; padding: 20px; padding-bottom: 100px; position: relative; } .animated-bg { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 0; overflow: hidden; background: radial-gradient(ellipse at top, #0a0a18 0%, #050508 50%, #020203 100%); } .bg-orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.5; } .bg-orb-1 { width: 500px; height: 500px; background: radial-gradient(circle, #312e81 0%, #1e1b4b 50%, transparent 70%); top: -150px; right: -150px; animation: floatOrb 12s ease-in-out infinite; } .bg-orb-2 { width: 450px; height: 450px; background: radial-gradient(circle, #1e3a5f 0%, #0f172a 50%, transparent 70%); bottom: -100px; left: -100px; animation: floatOrb 15s ease-in-out infinite reverse; } .bg-orb-3 { width: 700px; height: 700px; background: radial-gradient(circle, var(--theme-glow) 0%, transparent 60%); top: 35%; left: 50%; transform: translate(-50%, -50%); opacity: 0.4; transition: background 0.5s ease; animation: pulseOrb 6s ease-in-out infinite; } .bg-orb-4 { width: 300px; height: 300px; background: radial-gradient(circle, rgba(236, 72, 153, 0.3) 0%, transparent 70%); top: 60%; right: 10%; animation: floatOrb 18s ease-in-out infinite; } .bg-orb-5 { width: 250px; height: 250px; background: radial-gradient(circle, rgba(34, 211, 238, 0.25) 0%, transparent 70%); top: 20%; left: 5%; animation: floatOrb 20s ease-in-out infinite reverse; } @keyframes floatOrb { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-30px) scale(1.05); } } @keyframes pulseOrb { 0%, 100% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); } 50% { opacity: 0.5; transform: translate(-50%, -50%) scale(1.1); } } .bg-stars { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; } .star { position: absolute; background: white; border-radius: 50%; animation: twinkle 3s ease-in-out infinite; } .star.big { box-shadow: 0 0 6px 2px rgba(255, 255, 255, 0.3); } @keyframes twinkle { 0%, 100% { opacity: 0.2; transform: scale(1); } 50% { opacity: 0.8; transform: scale(1.2); } } @keyframes textShine { 0% { background-position: -200% center; } 100% { background-position: 200% center; } } @keyframes cardEnter { 0% { opacity: 0; transform: translateY(30px) scale(0.95); } 100% { opacity: 1; transform: translateY(0) scale(1); } } @keyframes subtleFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } } @keyframes pulseGlow { 0%, 100% { opacity: 0.5; transform: scale(1); } 50% { opacity: 0.8; transform: scale(1.05); } } @keyframes breatheGlow { 0%, 100% { filter: blur(40px); opacity: 0.6; } 50% { filter: blur(50px); opacity: 0.8; } } @keyframes buttonPulse { 0%, 100% { box-shadow: 0 15px 50px var(--theme-glow), 0 0 30px var(--theme-glow); } 50% { box-shadow: 0 20px 60px var(--theme-glow), 0 0 50px var(--theme-glow), 0 0 80px var(--theme-glow); } } @keyframes tagPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } } @keyframes borderGlow { 0%, 100% { border-color: rgba(255, 255, 255, 0.08); } 50% { border-color: rgba(255, 255, 255, 0.2); } } @keyframes iconBounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } } @keyframes rotateGlow { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } @keyframes emptyTextGlow { 0%, 100% { text-shadow: 0 0 20px rgba(156, 163, 175, 0.6), 0 0 40px rgba(156, 163, 175, 0.4); opacity: 0.9; } 50% { text-shadow: 0 0 30px rgba(156, 163, 175, 0.9), 0 0 60px rgba(156, 163, 175, 0.6), 0 0 80px rgba(156, 163, 175, 0.3); opacity: 1; } } @keyframes valueCountUp { 0% { transform: scale(1.3); opacity: 0.5; } 100% { transform: scale(1); opacity: 1; } } .header { text-align: center; margin-bottom: 25px; z-index: 10; width: 100%; max-width: 400px; animation: cardEnter 0.6s ease-out; } .brand-container { margin-bottom: 25px; } .brand-text { font-family: 'Orbitron', sans-serif; font-weight: 900; font-size: 2rem; letter-spacing: 4px; text-transform: uppercase; background: linear-gradient(90deg, #818cf8, #c4b5fd, #f0abfc, #c4b5fd, #818cf8); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: textShine 4s linear infinite; } .brand-subtitle { font-family: 'Rajdhani', sans-serif; font-size: 0.7rem; letter-spacing: 6px; color: var(--text-secondary); text-transform: uppercase; margin-top: 5px; } .demo-badge { display: inline-block; background: linear-gradient(135deg, #f59e0b, #d97706); color: #1a1a2e; font-family: 'Orbitron', sans-serif; font-size: 0.6rem; font-weight: 700; padding: 4px 12px; border-radius: 20px; margin-top: 8px; letter-spacing: 2px; text-transform: uppercase; box-shadow: 0 0 20px rgba(245, 158, 11, 0.4); } .balance-container { display: flex; justify-content: center; gap: 16px; } .balance-card { position: relative; display: flex; align-items: center; gap: 12px; padding: 14px 22px; background: linear-gradient(145deg, rgba(15, 15, 35, 0.95), rgba(8, 8, 20, 0.98)); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.08); overflow: hidden; min-width: 140px; transition: transform 0.3s ease, box-shadow 0.3s ease; } .balance-card:hover { transform: translateY(-3px); } .balance-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent); } .balance-card.sapphires { border-color: rgba(99, 102, 241, 0.3); box-shadow: 0 8px 32px rgba(99, 102, 241, 0.2), inset 0 1px 0 rgba(129, 140, 248, 0.15), 0 0 60px rgba(99, 102, 241, 0.15); } .balance-card.sapphires::after { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse at bottom left, rgba(99, 102, 241, 0.15), transparent 60%); pointer-events: none; } .balance-card.stars { border-color: rgba(251, 191, 36, 0.3); box-shadow: 0 8px 32px rgba(251, 191, 36, 0.15), inset 0 1px 0 rgba(251, 191, 36, 0.15), 0 0 60px rgba(251, 191, 36, 0.1); } .balance-card.stars::after { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse at bottom left, rgba(251, 191, 36, 0.15), transparent 60%); pointer-events: none; } .balance-icon-wrap { position: relative; width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; border-radius: 12px; flex-shrink: 0; } .balance-card.sapphires .balance-icon-wrap { background: linear-gradient(145deg, rgba(99, 102, 241, 0.3), rgba(99, 102, 241, 0.15)); box-shadow: 0 0 25px rgba(99, 102, 241, 0.4); } .balance-card.stars .balance-icon-wrap { background: linear-gradient(145deg, rgba(251, 191, 36, 0.3), rgba(251, 191, 36, 0.15)); box-shadow: 0 0 25px rgba(251, 191, 36, 0.4); } .balance-icon { font-size: 1.4rem; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); position: relative; z-index: 1; } .balance-icon-img { width: 28px; height: 28px; object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); } .balance-info { display: flex; flex-direction: column; gap: 2px; position: relative; z-index: 1; } .balance-value { font-family: 'Orbitron', sans-serif; font-size: 1.25rem; font-weight: 700; line-height: 1; transition: transform 0.3s ease; } .balance-value.updated { animation: valueCountUp 0.4s ease-out; } .balance-card.sapphires .balance-value { background: linear-gradient(135deg, #c4b5fd, #818cf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; } .balance-card.stars .balance-value { background: linear-gradient(135deg, #fef3c7, #fbbf24); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; } .balance-label { font-family: 'Rajdhani', sans-serif; font-size: 0.65rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1.5px; } .menu-screen { z-index: 10; width: 100%; max-width: 400px; animation: cardEnter 0.6s ease-out; } .menu-screen.hidden { display: none; } .menu-title { text-align: center; font-family: 'Rajdhani', sans-serif; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 25px; letter-spacing: 4px; text-transform: uppercase; position: relative; } .menu-title::before, .menu-title::after { content: ''; position: absolute; top: 50%; width: 50px; height: 1px; background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.5)); } .menu-title::before { left: 20px; } .menu-title::after { right: 20px; transform: rotate(180deg); } .cases-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; } .case-card { position: relative; border-radius: 28px; padding: 28px 16px; text-align: center; cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease; -webkit-tap-highlight-color: transparent; overflow: hidden; background: transparent; border: none; animation: cardEnter 0.5s ease-out backwards; } .case-card:nth-child(1) { animation-delay: 0.1s; } .case-card:nth-child(2) { animation-delay: 0.2s; } .case-card:nth-child(3) { animation-delay: 0.3s; } .case-card:nth-child(4) { animation-delay: 0.4s; } .case-card::before { content: ''; position: absolute; inset: 0; border-radius: 28px; padding: 2px; background: linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.02)); -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: xor; mask-composite: exclude; pointer-events: none; } .case-card-bg { position: absolute; inset: 0; border-radius: 28px; background: linear-gradient(145deg, rgba(15, 15, 35, 0.9), rgba(8, 8, 20, 0.95)); z-index: 0; } .case-card-glow { position: absolute; inset: -40px; border-radius: 50%; filter: blur(40px); opacity: 0.6; pointer-events: none; z-index: 0; transition: all 0.4s ease; animation: breatheGlow 4s ease-in-out infinite; } .case-card:hover .case-card-glow, .case-card:active .case-card-glow { opacity: 1; filter: blur(50px); transform: scale(1.15); } .case-card.cosmic-style .case-card-glow { background: radial-gradient(circle, rgba(99, 102, 241, 0.8) 0%, rgba(99, 102, 241, 0.4) 40%, transparent 70%); } .case-card.stellar-style .case-card-glow { background: radial-gradient(circle, rgba(236, 72, 153, 0.8) 0%, rgba(236, 72, 153, 0.4) 40%, transparent 70%); } .case-card.golden-style .case-card-glow { background: radial-gradient(circle, rgba(251, 191, 36, 0.8) 0%, rgba(251, 191, 36, 0.4) 40%, transparent 70%); } .case-card.divine-style .case-card-glow { background: radial-gradient(circle, rgba(34, 211, 238, 0.8) 0%, rgba(34, 211, 238, 0.4) 40%, transparent 70%); } .case-card:active { transform: scale(0.97); } @media (min-width: 769px) { .case-card:hover { transform: translateY(-8px) scale(1.02); } } .case-card.cosmic-style { box-shadow: 0 10px 40px rgba(99, 102, 241, 0.25), 0 0 80px rgba(99, 102, 241, 0.15); } .case-card.cosmic-style:hover { box-shadow: 0 20px 60px rgba(99, 102, 241, 0.4), 0 0 100px rgba(99, 102, 241, 0.25); } .case-card.cosmic-style .case-card-name { background: linear-gradient(135deg, #e0e7ff, #a78bfa, #818cf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; } .case-card.stellar-style { box-shadow: 0 10px 40px rgba(236, 72, 153, 0.25), 0 0 80px rgba(236, 72, 153, 0.15); } .case-card.stellar-style:hover { box-shadow: 0 20px 60px rgba(236, 72, 153, 0.4), 0 0 100px rgba(236, 72, 153, 0.25); } .case-card.stellar-style .case-card-name { background: linear-gradient(135deg, #fce7f3, #f472b6, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; } .case-card.golden-style { box-shadow: 0 10px 40px rgba(251, 191, 36, 0.3), 0 0 80px rgba(251, 191, 36, 0.15); } .case-card.golden-style:hover { box-shadow: 0 20px 60px rgba(251, 191, 36, 0.45), 0 0 100px rgba(251, 191, 36, 0.25); } .case-card.golden-style .case-card-name { background: linear-gradient(135deg, #fef3c7, #fbbf24, #f59e0b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; } .case-card.divine-style { box-shadow: 0 10px 40px rgba(34, 211, 238, 0.3), 0 0 80px rgba(34, 211, 238, 0.15); } .case-card.divine-style:hover { box-shadow: 0 20px 60px rgba(34, 211, 238, 0.45), 0 0 100px rgba(34, 211, 238, 0.25); } .case-card.divine-style .case-card-name { background: linear-gradient(135deg, #cffafe, #22d3ee, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; } .case-card-image-container { position: relative; width: 100px; height: 100px; margin: 0 auto 16px; z-index: 2; } .case-card-image { width: 90px; height: 90px; object-fit: cover; border-radius: 22px; filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.6)); border: 2px solid rgba(255, 255, 255, 0.15); position: relative; z-index: 1; animation: subtleFloat 4s ease-in-out infinite; transition: transform 0.3s ease; } .case-card:hover .case-card-image { transform: scale(1.05); } .case-card:nth-child(1) .case-card-image { animation-delay: 0s; } .case-card:nth-child(2) .case-card-image { animation-delay: 1s; } .case-card:nth-child(3) .case-card-image { animation-delay: 2s; } .case-card:nth-child(4) .case-card-image { animation-delay: 3s; } .case-card-name { font-family: 'Orbitron', sans-serif; font-size: 0.8rem; font-weight: 700; margin-bottom: 12px; letter-spacing: 1px; text-transform: uppercase; position: relative; z-index: 2; } .case-card-price { font-family: 'Orbitron', sans-serif; font-size: 0.9rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 6px; position: relative; z-index: 2; } .case-card-price-text { color: #c4b5fd; text-shadow: 0 0 20px rgba(139, 92, 246, 0.7); } .case-card-tag { position: absolute; top: 12px; right: 12px; font-family: 'Orbitron', sans-serif; font-size: 0.55rem; font-weight: 700; padding: 5px 10px; border-radius: 10px; text-transform: uppercase; letter-spacing: 1px; z-index: 3; animation: tagPulse 2s ease-in-out infinite; } .case-card.cosmic-style .case-card-tag { background: linear-gradient(135deg, #6366f1, #818cf8); color: #fff; box-shadow: 0 0 20px rgba(99, 102, 241, 0.5); } .case-card.stellar-style .case-card-tag { background: linear-gradient(135deg, #ec4899, #f472b6); color: #fff; box-shadow: 0 0 20px rgba(236, 72, 153, 0.5); } .case-card.golden-style .case-card-tag { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #1a1a2e; box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); } .case-card.divine-style .case-card-tag { background: linear-gradient(135deg, #22d3ee, #06b6d4); color: #042f2e; box-shadow: 0 0 20px rgba(34, 211, 238, 0.5); } .case-screen { z-index: 10; width: 100%; max-width: 400px; display: flex; flex-direction: column; align-items: center; } .case-screen.hidden { display: none; } body.theme-cosmic { --theme-color: #6366f1; --theme-color-light: #818cf8; --theme-glow: rgba(99, 102, 241, 0.5); } body.theme-stellar { --theme-color: #ec4899; --theme-color-light: #f472b6; --theme-glow: rgba(236, 72, 153, 0.5); } body.theme-golden { --theme-color: #fbbf24; --theme-color-light: #fcd34d; --theme-glow: rgba(251, 191, 36, 0.5); } body.theme-divine { --theme-color: #22d3ee; --theme-color-light: #67e8f9; --theme-glow: rgba(34, 211, 238, 0.5); } .case-display { text-align: center; margin-bottom: 25px; z-index: 10; animation: cardEnter 0.6s ease-out 0.1s both; } .case-hero { position: relative; width: 160px; height: 160px; margin: 0 auto 20px; } .case-hero-glow { position: absolute; inset: -60px; background: radial-gradient(circle, var(--theme-glow) 0%, var(--theme-glow) 20%, transparent 70%); border-radius: 50%; filter: blur(40px); opacity: 0.8; animation: pulseGlow 3s ease-in-out infinite; } .case-hero-glow-inner { position: absolute; inset: -30px; background: radial-gradient(circle, var(--theme-color) 0%, transparent 60%); border-radius: 50%; filter: blur(25px); opacity: 0.4; animation: rotateGlow 20s linear infinite; } .case-hero-content { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; z-index: 2; animation: subtleFloat 4s ease-in-out infinite; } .case-emoji { font-size: 5.5rem; filter: drop-shadow(0 10px 40px var(--theme-glow)); } .case-emoji.hidden { display: none; } .case-display-image { width: 120px; height: 120px; object-fit: cover; border-radius: 28px; filter: drop-shadow(0 10px 40px var(--theme-glow)); border: 3px solid rgba(255, 255, 255, 0.2); transition: transform 0.3s ease; } .case-display-image:hover { transform: scale(1.05) rotate(2deg); } .case-display-image.hidden { display: none; } .case-name { font-family: 'Orbitron', sans-serif; font-size: 1.2rem; font-weight: 700; background: linear-gradient(90deg, var(--theme-color-light), var(--theme-color), var(--theme-color-light), rgba(255,255,255,0.9), var(--theme-color-light), var(--theme-color), var(--theme-color-light) ); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: 3px; text-transform: uppercase; animation: textShine 6s ease-in-out infinite; background-size: 300% auto; } .case-section { width: 100%; max-width: 400px; z-index: 10; animation: cardEnter 0.6s ease-out 0.2s both; } .case-container { position: relative; width: 100%; height: 130px; background: linear-gradient(180deg, rgba(15, 15, 35, 0.9), rgba(10, 10, 25, 0.95)); border-radius: 24px; overflow: hidden; border: 2px solid rgba(255, 255, 255, 0.1); box-shadow: 0 0 50px var(--theme-glow), inset 0 0 30px rgba(0,0,0,0.3); } .case-container::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, rgba(5, 5, 10, 1) 0%, transparent 15%, transparent 85%, rgba(5, 5, 10, 1) 100%); z-index: 10; pointer-events: none; } .center-pointer { position: absolute; top: 0; left: 50%; transform: translateX(-50%); z-index: 20; display: flex; flex-direction: column; align-items: center; } .pointer-arrow { width: 0; height: 0; border-left: 14px solid transparent; border-right: 14px solid transparent; border-top: 22px solid var(--theme-color); filter: drop-shadow(0 0 15px var(--theme-color)); animation: pulseGlow 2s ease-in-out infinite; } .pointer-line { width: 3px; height: 130px; background: linear-gradient(180deg, var(--theme-color), transparent); opacity: 0.5; } .bottom-pointer { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); z-index: 20; } .bottom-pointer .pointer-arrow { border-top: none; border-bottom: 22px solid var(--theme-color); } .items-strip { display: flex; align-items: center; height: 100%; position: absolute; top: 0; left: 0; will-change: transform; } .items-strip.animating { transition: transform 5s cubic-bezier(0.15, 0.85, 0.25, 1); } .prize-item { flex-shrink: 0; width: 100px; height: 100px; margin: 0 6px; border-radius: 18px; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; border: 2px solid rgba(255, 255, 255, 0.1); transition: transform 0.2s ease; } .prize-item.has-image { background: transparent !important; } .prize-item.rarity-empty { background: linear-gradient(145deg, rgba(55, 65, 81, 0.7), rgba(31, 41, 55, 0.8)); border-color: rgba(107, 114, 128, 0.4); } .prize-item.rarity-stars-15 { background: linear-gradient(145deg, rgba(52, 211, 153, 0.8), rgba(16, 185, 129, 0.85)); border-color: rgba(52, 211, 153, 0.6); box-shadow: 0 0 20px rgba(52, 211, 153, 0.4); } .prize-item.rarity-stars-25 { background: linear-gradient(145deg, rgba(45, 212, 191, 0.8), rgba(20, 184, 166, 0.85)); border-color: rgba(45, 212, 191, 0.6); box-shadow: 0 0 20px rgba(45, 212, 191, 0.4); } .prize-item.rarity-stars-50 { background: linear-gradient(145deg, rgba(59, 130, 246, 0.85), rgba(37, 99, 235, 0.9)); border-color: rgba(59, 130, 246, 0.6); box-shadow: 0 0 25px rgba(59, 130, 246, 0.45); } .prize-item.rarity-stars-75 { background: linear-gradient(145deg, rgba(99, 102, 241, 0.85), rgba(79, 70, 229, 0.9)); border-color: rgba(99, 102, 241, 0.6); box-shadow: 0 0 25px rgba(99, 102, 241, 0.45); } .prize-item.rarity-stars-100 { background: linear-gradient(145deg, rgba(139, 92, 246, 0.85), rgba(124, 58, 237, 0.9)); border-color: rgba(139, 92, 246, 0.6); box-shadow: 0 0 30px rgba(139, 92, 246, 0.5); } .prize-item.rarity-stars-150 { background: linear-gradient(145deg, rgba(168, 85, 247, 0.85), rgba(147, 51, 234, 0.9)); border-color: rgba(168, 85, 247, 0.65); box-shadow: 0 0 30px rgba(168, 85, 247, 0.5); } .prize-item.rarity-stars-250 { background: linear-gradient(145deg, rgba(236, 72, 153, 0.85), rgba(219, 39, 119, 0.9)); border-color: rgba(236, 72, 153, 0.65); box-shadow: 0 0 35px rgba(236, 72, 153, 0.55); } .prize-item.rarity-stars-500 { background: linear-gradient(145deg, rgba(251, 146, 60, 0.9), rgba(249, 115, 22, 0.92)); border-color: rgba(251, 146, 60, 0.7); box-shadow: 0 0 40px rgba(251, 146, 60, 0.6); } .prize-item.rarity-stars-1000 { background: linear-gradient(145deg, rgba(251, 191, 36, 0.9), rgba(245, 158, 11, 0.92)); border-color: rgba(251, 191, 36, 0.75); box-shadow: 0 0 45px rgba(251, 191, 36, 0.65); } .prize-item.rarity-stars-9999 { background: linear-gradient(145deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.92)); border-color: rgba(239, 68, 68, 0.8); box-shadow: 0 0 50px rgba(239, 68, 68, 0.7), 0 0 80px rgba(251, 191, 36, 0.4); } .prize-image { position: absolute; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; object-fit: cover; border-radius: 16px; } .prize-item.winner { animation: winnerPop 0.5s ease-out; border-color: var(--theme-color) !important; box-shadow: 0 0 60px var(--theme-glow) !important; } @keyframes winnerPop { 0% { transform: scale(1); } 50% { transform: scale(1.12); } 100% { transform: scale(1); } } .spin-button { background: linear-gradient(135deg, var(--theme-color), var(--theme-color-light)); border: none; padding: 20px 50px; font-family: 'Orbitron', sans-serif; font-size: 0.95rem; font-weight: 700; letter-spacing: 2px; color: #0a0a14; border-radius: 18px; cursor: pointer; box-shadow: 0 15px 50px var(--theme-glow), 0 0 30px var(--theme-glow); transition: transform 0.3s ease, box-shadow 0.3s ease; z-index: 10; display: flex; align-items: center; gap: 14px; margin-top: 25px; text-transform: uppercase; -webkit-tap-highlight-color: transparent; animation: cardEnter 0.6s ease-out 0.3s both, buttonPulse 3s ease-in-out infinite 1s; } .spin-button:active:not(:disabled) { transform: scale(0.97); } @media (min-width: 769px) { .spin-button:hover:not(:disabled) { transform: translateY(-4px) scale(1.02); box-shadow: 0 25px 70px var(--theme-glow), 0 0 50px var(--theme-glow); animation: none; } } .spin-button:disabled { background: linear-gradient(135deg, #374151, #1f2937); cursor: not-allowed; box-shadow: none; animation: none; } .spin-cost { background: rgba(0, 0, 0, 0.25); padding: 8px 16px; border-radius: 12px; font-size: 0.8rem; letter-spacing: 1px; } .back-to-menu-btn { background: transparent; border: 1px solid rgba(255, 255, 255, 0.15); padding: 14px 28px; font-family: 'Rajdhani', sans-serif; font-size: 0.9rem; font-weight: 600; color: var(--text-secondary); border-radius: 14px; cursor: pointer; transition: all 0.3s ease; margin-top: 15px; z-index: 10; letter-spacing: 1px; -webkit-tap-highlight-color: transparent; } .back-to-menu-btn:hover, .back-to-menu-btn:active { border-color: var(--theme-color); color: var(--text-primary); box-shadow: 0 0 30px var(--theme-glow); } .info-section { margin-top: 35px; width: 100%; max-width: 400px; z-index: 10; animation: cardEnter 0.6s ease-out 0.4s both; } .info-title { text-align: center; font-family: 'Rajdhani', sans-serif; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 18px; letter-spacing: 3px; text-transform: uppercase; } .prizes-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; } .prizes-grid.cols-3 { grid-template-columns: repeat(3, 1fr); } .prizes-grid.cols-4 { grid-template-columns: repeat(4, 1fr); } .prizes-grid.cols-5 { grid-template-columns: repeat(5, 1fr); } .prizes-grid.cols-6 { grid-template-columns: repeat(3, 1fr); } .prizes-grid.cols-7 { grid-template-columns: repeat(4, 1fr); } .prize-card { background: linear-gradient(145deg, rgba(20, 20, 40, 0.9), rgba(10, 10, 25, 0.95)); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 16px; padding: 10px; padding-bottom: 12px; text-align: center; transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease; } @media (min-width: 769px) { .prize-card:hover { transform: translateY(-4px) scale(1.02); border-color: var(--theme-color); box-shadow: 0 12px 40px var(--theme-glow); } } .prize-card.stars-15 { border-color: rgba(52, 211, 153, 0.4); background: linear-gradient(145deg, rgba(52, 211, 153, 0.12), rgba(15, 15, 35, 0.95)); } .prize-card.stars-25 { border-color: rgba(45, 212, 191, 0.4); background: linear-gradient(145deg, rgba(45, 212, 191, 0.12), rgba(15, 15, 35, 0.95)); } .prize-card.stars-50 { border-color: rgba(59, 130, 246, 0.4); background: linear-gradient(145deg, rgba(59, 130, 246, 0.12), rgba(15, 15, 35, 0.95)); } .prize-card.stars-75 { border-color: rgba(99, 102, 241, 0.4); background: linear-gradient(145deg, rgba(99, 102, 241, 0.12), rgba(15, 15, 35, 0.95)); } .prize-card.stars-100 { border-color: rgba(139, 92, 246, 0.45); background: linear-gradient(145deg, rgba(139, 92, 246, 0.12), rgba(15, 15, 35, 0.95)); } .prize-card.stars-150 { border-color: rgba(168, 85, 247, 0.45); background: linear-gradient(145deg, rgba(168, 85, 247, 0.12), rgba(15, 15, 35, 0.95)); } .prize-card.stars-250 { border-color: rgba(236, 72, 153, 0.45); background: linear-gradient(145deg, rgba(236, 72, 153, 0.12), rgba(15, 15, 35, 0.95)); } .prize-card.stars-500 { border-color: rgba(251, 146, 60, 0.5); background: linear-gradient(145deg, rgba(251, 146, 60, 0.14), rgba(15, 15, 35, 0.95)); } .prize-card.stars-1000 { border-color: rgba(251, 191, 36, 0.5); background: linear-gradient(145deg, rgba(251, 191, 36, 0.14), rgba(15, 15, 35, 0.95)); } .prize-card.stars-9999 { border-color: rgba(239, 68, 68, 0.5); background: linear-gradient(145deg, rgba(239, 68, 68, 0.14), rgba(15, 15, 35, 0.95)); } .prize-card.empty { border-color: rgba(107, 114, 128, 0.25); background: linear-gradient(145deg, rgba(55, 65, 81, 0.15), rgba(15, 15, 35, 0.95)); opacity: 0.6; } .prize-card.empty .prize-card-name { background: linear-gradient(135deg, #6b7280, #9ca3af); -webkit-background-clip: text; -webkit-text-fill-color: transparent; } .prize-card-visual { width: 100%; aspect-ratio: 1; border-radius: 12px; overflow: hidden; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); } .prize-card-image { width: 100%; height: 100%; object-fit: cover; } .prize-card-name { font-family: 'Orbitron', sans-serif; font-size: 0.65rem; font-weight: 600; background: linear-gradient(135deg, var(--theme-color-light), var(--theme-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; letter-spacing: 0.5px; } .status-message { background: linear-gradient(135deg, rgba(127, 29, 29, 0.7), rgba(69, 10, 10, 0.7)); border: 1px solid rgba(239, 68, 68, 0.4); border-radius: 16px; padding: 16px; margin-top: 15px; text-align: center; font-size: 0.85rem; display: none; z-index: 10; width: 100%; max-width: 400px; } .status-message.success { background: linear-gradient(135deg, rgba(21, 87, 36, 0.7), rgba(6, 78, 59, 0.7)); border-color: rgba(34, 197, 94, 0.4); } .status-message.show { display: block; animation: cardEnter 0.3s ease-out; } /* ========== MODAL ========== */ .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); display: flex; align-items: center; justify-content: center; z-index: 100; opacity: 0; visibility: hidden; transition: opacity 0.15s ease, visibility 0.15s ease; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); } .modal-overlay.show { opacity: 1; visibility: visible; } .modal { background: linear-gradient(180deg, rgba(20, 20, 50, 0.98) 0%, rgba(10, 10, 25, 0.99) 100%); border-radius: 28px; padding: 35px 30px; text-align: center; max-width: 320px; width: 90%; transform: scale(0.95); transition: transform 0.15s ease-out; border: 2px solid var(--theme-color); position: relative; overflow: hidden; box-shadow: 0 0 80px var(--theme-glow), 0 25px 80px rgba(0, 0, 0, 0.8); } .modal::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, var(--theme-color-light), transparent); } .modal-overlay.show .modal { transform: scale(1); } .modal.win { border-color: var(--theme-color); box-shadow: 0 0 100px var(--theme-glow), 0 25px 80px rgba(0, 0, 0, 0.8); } .modal.lose { border-color: rgba(107, 114, 128, 0.5); box-shadow: 0 0 60px rgba(107, 114, 128, 0.4), 0 25px 80px rgba(0, 0, 0, 0.8); } .modal-emoji { font-size: 4.5rem; margin-bottom: 15px; filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.5)); position: relative; z-index: 2; } .modal-prize-image { width: 100px; height: 100px; object-fit: cover; margin-bottom: 15px; border-radius: 22px; border: 3px solid rgba(255, 255, 255, 0.2); box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5); position: relative; z-index: 2; } .modal.win .modal-prize-image { box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5), 0 0 40px var(--theme-glow); border-color: var(--theme-color); } .modal-title { font-family: 'Orbitron', sans-serif; font-size: 1.3rem; font-weight: 700; margin-bottom: 12px; letter-spacing: 2px; text-transform: uppercase; position: relative; z-index: 2; } .modal.win .modal-title { background: linear-gradient(135deg, #fff, var(--theme-color-light), #fff); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: textShine 3s linear infinite; } .modal.lose .modal-title { font-family: 'Orbitron', sans-serif; font-size: 1.8rem; font-weight: 900; background: linear-gradient(135deg, #e5e7eb, #9ca3af, #6b7280, #9ca3af, #e5e7eb); background-size: 300% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: textShine 4s linear infinite, emptyTextGlow 2.5s ease-in-out infinite; letter-spacing: 6px; } .modal-prize { font-family: 'Orbitron', sans-serif; font-size: 2.2rem; font-weight: 900; background: linear-gradient(135deg, #fff, var(--theme-color-light), var(--theme-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 18px; position: relative; z-index: 2; filter: drop-shadow(0 4px 15px var(--theme-glow)); } .modal.lose .modal-prize { font-size: 0.95rem; font-weight: 600; background: linear-gradient(135deg, #a1a1aa, #71717a); -webkit-background-clip: text; filter: none; } .modal-balance { display: flex; justify-content: center; gap: 12px; margin-bottom: 20px; position: relative; z-index: 2; } .modal-balance-item { display: flex; align-items: center; gap: 8px; padding: 12px 18px; background: linear-gradient(145deg, rgba(25, 25, 55, 0.95), rgba(12, 12, 30, 0.98)); border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.1); position: relative; } .modal-balance-item::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.25), transparent); } .modal-balance-item.sapphire { border-color: rgba(99, 102, 241, 0.4); box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); } .modal-balance-item.star { border-color: rgba(251, 191, 36, 0.4); box-shadow: 0 0 20px rgba(251, 191, 36, 0.3); } .modal-balance-icon { width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0; } .modal-balance-icon img { width: 100%; height: 100%; object-fit: contain; } .modal-balance-value { font-family: 'Orbitron', sans-serif; font-size: 1.1rem; font-weight: 700; line-height: 1; } .modal-balance-item.sapphire .modal-balance-value { background: linear-gradient(135deg, #c4b5fd, #818cf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; } .modal-balance-item.star .modal-balance-value { background: linear-gradient(135deg, #fef3c7, #fbbf24); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; } .modal-buttons { display: flex; flex-direction: column; gap: 10px; position: relative; z-index: 2; } .modal-button { background: linear-gradient(135deg, var(--theme-color), var(--theme-color-light)); border: none; padding: 16px 32px; font-family: 'Orbitron', sans-serif; font-size: 0.85rem; font-weight: 700; letter-spacing: 2px; color: #0a0a14; border-radius: 14px; cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease; text-transform: uppercase; -webkit-tap-highlight-color: transparent; position: relative; overflow: hidden; } .modal-button:active { transform: scale(0.97); } @media (min-width: 769px) { .modal-button:hover { transform: scale(1.03); box-shadow: 0 12px 40px var(--theme-glow); } } .modal-button.secondary { background: transparent; border: 2px solid rgba(255, 255, 255, 0.15); color: var(--text-secondary); padding: 14px 32px; } .modal-button.secondary:hover, .modal-button.secondary:active { background: rgba(255, 255, 255, 0.05); border-color: rgba(255, 255, 255, 0.3); color: white; } .modal-button.theme-btn { background: linear-gradient(135deg, var(--theme-color), var(--theme-color-light)); color: #1a1a2e; box-shadow: 0 8px 30px var(--theme-glow); } .modal-button.theme-btn:hover { box-shadow: 0 12px 50px var(--theme-glow); } .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-primary); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 200; transition: opacity 0.4s ease; } .loading-overlay.hidden { opacity: 0; pointer-events: none; } .loader { width: 50px; height: 50px; border: 3px solid rgba(99, 102, 241, 0.15); border-top-color: var(--accent-gold); border-right-color: var(--accent-purple); border-radius: 50%; animation: spin 0.8s linear infinite; } @keyframes spin { to { transform: rotate(360deg); } } .loading-text { margin-top: 20px; font-family: 'Orbitron', sans-serif; color: var(--text-secondary); letter-spacing: 4px; font-size: 0.75rem; text-transform: uppercase; animation: textShine 2s linear infinite; background: linear-gradient(90deg, #71717a, #a1a1aa, #71717a); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; } .session-info { position: fixed; bottom: 5px; left: 5px; font-size: 0.55rem; color: rgba(255,255,255,0.1); z-index: 1; font-family: monospace; } /* ========== MAGIC SPARKLE EFFECT ========== */ .sparkle-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; border-radius: 28px; } @media (max-width: 390px) { .case-container { height: 115px; } .prize-item { width: 90px; height: 90px; } .pointer-line { height: 115px; } .brand-text { font-size: 1.7rem; } .balance-card { padding: 12px 18px; min-width: 125px; } .balance-icon-wrap { width: 38px; height: 38px; } .balance-value { font-size: 1.1rem; } .case-hero { width: 140px; height: 140px; } .case-display-image { width: 100px; height: 100px; } .modal { padding: 30px 22px; } .modal-balance { gap: 8px; } .modal-balance-item { padding: 8px 12px; } } @media (max-width: 380px) { .case-container { height: 110px; } .prize-item { width: 85px; height: 85px; } .brand-text { font-size: 1.5rem; } .pointer-line { height: 110px; } .balance-container { gap: 10px; } .balance-card { padding: 10px 14px; min-width: 115px; gap: 10px; } .balance-icon-wrap { width: 34px; height: 34px; } .balance-icon { font-size: 1.2rem; } .balance-value { font-size: 1rem; } .case-hero { width: 120px; height: 120px; } .case-display-image { width: 85px; height: 85px; } .modal-balance { flex-direction: column; gap: 10px; } } @supports (padding: max(0px)) { body { padding-left: max(20px, env(safe-area-inset-left)); padding-right: max(20px, env(safe-area-inset-right)); padding-bottom: max(100px, env(safe-area-inset-bottom)); } } @media (max-width: 768px) { .bg-orb-1, .bg-orb-2, .bg-orb-4, .bg-orb-5 { animation: none; } .star { animation-duration: 4s; } } </style> </head> <body> <div class="loading-overlay" id="loadingOverlay"> <div class="loader"></div> <div class="loading-text">Loading</div> </div> <div class="animated-bg"> <div class="bg-orb bg-orb-1"></div> <div class="bg-orb bg-orb-2"></div> <div class="bg-orb bg-orb-3" id="themeFog"></div> <div class="bg-orb bg-orb-4"></div> <div class="bg-orb bg-orb-5"></div> <div class="bg-stars" id="bgStars"></div> </div> <div class="header"> <div class="brand-container"> <h1 class="brand-text">Divine Case</h1> <div class="brand-subtitle">Premium Loot Experience</div> <div class="demo-badge" id="demoBadge" style="display: none;">DEMO MODE</div> </div> <div class="balance-container"> <div class="balance-card sapphires"> <div class="balance-icon-wrap"> <span class="balance-icon" id="sapphireIcon">üíé</span> </div> <div class="balance-info"> <span class="balance-value" id="sapphires">0</span> <span class="balance-label">Sapphires</span> </div> </div> <div class="balance-card stars"> <div class="balance-icon-wrap"> <span class="balance-icon" id="starIcon">‚≠ê</span> </div> <div class="balance-info"> <span class="balance-value" id="stars-balance">0</span> <span class="balance-label">Stars</span> </div> </div> </div> </div> <div class="menu-screen" id="menuScreen"> <div class="menu-title">–í—ã–±–µ—Ä–∏—Ç–µ –∫–µ–π—Å</div> <div class="cases-grid" id="casesGrid"></div> </div> <div class="case-screen hidden" id="caseScreen"> <div class="case-display"> <div class="case-hero"> <div class="case-hero-glow"></div> <div class="case-hero-glow-inner"></div> <div class="case-hero-content"> <span class="case-emoji" id="currentCaseEmoji"></span> <img class="case-display-image hidden" id="currentCaseImage" src="" alt=""> </div> </div> <div class="case-name" id="currentCaseName">Cosmic Case</div> </div> <div class="case-section"> <div class="case-container" id="caseContainer"> <div class="center-pointer"> <div class="pointer-arrow"></div> <div class="pointer-line"></div> </div> <div class="bottom-pointer"> <div class="pointer-arrow"></div> </div> <div class="items-strip" id="itemsStrip"></div> </div> </div> <button class="spin-button" id="spinBtn" onclick="openCase()"> <span>–û—Ç–∫—Ä—ã—Ç—å</span> <span class="spin-cost" id="spinCost">100</span> </button> <button class="back-to-menu-btn" onclick="goToMenu()">–ù–∞–∑–∞–¥ –∫ –∫–µ–π—Å–∞–º</button> <div class="status-message" id="statusMessage"></div> <div class="info-section"> <div class="info-title">–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏–∑—ã</div> <div class="prizes-grid" id="prizesGrid"></div> </div> </div> <div class="session-info" id="sessionInfo"></div> <div class="modal-overlay" id="modalOverlay"> <div class="modal" id="modal"> <div class="modal-emoji" id="modalEmoji"></div> <div class="modal-title" id="modalTitle">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</div> <div class="modal-prize" id="modalPrize">+50</div> <div class="modal-balance" id="modalBalance"> <div class="modal-balance-item sapphire"> <div class="modal-balance-icon" id="modalSapphireIcon">üíé</div> <span class="modal-balance-value" id="modalSapphires">0</span> </div> <div class="modal-balance-item star"> <div class="modal-balance-icon" id="modalStarIcon">‚≠ê</div> <span class="modal-balance-value" id="modalStars">0</span> </div> </div> <div class="modal-buttons"> <button class="modal-button theme-btn" id="spinAgainBtn" onclick="spinAgain()">–û—Ç–∫—Ä—ã—Ç—å –µ—â—ë</button> <button class="modal-button secondary" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button> </div> </div> </div> <script> const API_BASE = "https://deadveel.pythonanywhere.com"; const tg = window.Telegram?.WebApp; const initData = tg?.initData || ''; const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 769; // Demo mode detection const DEMO_MODE = !initData || initData.length < 10; const GITHUB_USER = "deadveel-crypto"; const GITHUB_REPO = "divine-case-assets"; const GITHUB_BRANCH = "main"; const IMG_CDN = `https://cdn.jsdelivr.net/gh/${GITHUB_USER}/${GITHUB_REPO}@${GITHUB_BRANCH}`; const CASES = [ { id: 'cosmic', name: 'Cosmic Case', image: `${IMG_CDN}/cases/cosmic.png`, cost: 100, tag: 'NEW', style: 'cosmic-style', theme: 'theme-cosmic' }, { id: 'stellar', name: 'Stellar Case', image: `${IMG_CDN}/cases/stellar.png`, cost: 250, tag: 'BEST', style: 'stellar-style', theme: 'theme-stellar' }, { id: 'golden', name: 'Golden Case', image: `${IMG_CDN}/cases/golden.png`, cost: 500, tag: 'HOT', style: 'golden-style', theme: 'theme-golden' }, { id: 'divine', name: 'Divine Case', image: `${IMG_CDN}/cases/divine.png`, cost: 1000, tag: 'VIP', style: 'divine-style', theme: 'theme-divine' } ]; let STATE = { userId: null, username: '', sapphires: 0, stars: 0, spinCost: 100, canSpin: true, isInitialized: false, spinsCount: 0, totalWon: 0, isModalOpen: false, currentScreen: 'menu', selectedCase: null }; let isSpinning = false; const PRIZE_VISUALS = { 0: { stars: 0, rarity: "empty", image: `${IMG_CDN}/prizes/void.png`, name: "Void" }, 15: { stars: 15, rarity: "stars-15", image: `${IMG_CDN}/prizes/glimmer.png`, name: "Glimmer" }, 25: { stars: 25, rarity: "stars-25", image: `${IMG_CDN}/prizes/spark.png`, name: "Spark" }, 50: { stars: 50, rarity: "stars-50", image: `${IMG_CDN}/prizes/radiance.png`, name: "Radiance" }, 75: { stars: 75, rarity: "stars-75", image: `${IMG_CDN}/prizes/stardust.png`, name: "Stardust" }, 100: { stars: 100, rarity: "stars-100", image: `${IMG_CDN}/prizes/aurora.png`, name: "Aurora" }, 150: { stars: 150, rarity: "stars-150", image: `${IMG_CDN}/prizes/ember.png`, name: "Ember" }, 250: { stars: 250, rarity: "stars-250", image: `${IMG_CDN}/prizes/lightning.jpeg`, name: "Lightning" }, 500: { stars: 500, rarity: "stars-500", image: `${IMG_CDN}/prizes/supernova.png`, name: "Supernova" }, 1000: { stars: 1000, rarity: "stars-1000", image: `${IMG_CDN}/prizes/galaxy.png`, name: "Galaxy" }, 9999: { stars: 9999, rarity: "stars-9999", image: `${IMG_CDN}/prizes/divine_star.png`, name: "Divine Star" } }; const TEST_MODE = true; const CASE_CONFIG = { cosmic: { prizes: [0, 15, 25, 50, 75, 100], getRandomPrize: () => { if (TEST_MODE) { const wins = [25, 50, 75, 100]; return wins[Math.floor(Math.random() * wins.length)]; } const rand = Math.random() * 100; if (rand < 93) return 0; if (rand < 98) return 15; return 25; } }, stellar: { prizes: [0, 25, 50, 75, 100, 150, 250], getRandomPrize: () => { if (TEST_MODE) { const wins = [50, 75, 100, 150, 250]; return wins[Math.floor(Math.random() * wins.length)]; } const rand = Math.random() * 100; if (rand < 93) return 0; if (rand < 98) return 25; return 50; } }, golden: { prizes: [0, 75, 100, 150, 250, 500], getRandomPrize: () => { if (TEST_MODE) { const wins = [100, 150, 250, 500]; return wins[Math.floor(Math.random() * wins.length)]; } const rand = Math.random() * 100; if (rand < 93) return 0; if (rand < 98) return 75; return 100; } }, divine: { prizes: [0, 100, 150, 250, 500, 1000, 9999], getRandomPrize: () => { if (TEST_MODE) { const wins = [150, 250, 500, 1000, 9999]; return wins[Math.floor(Math.random() * wins.length)]; } const rand = Math.random() * 100; if (rand < 93) return 0; if (rand < 98) return 100; return 150; } } }; // ============ MAGIC SPARKLE EFFECT SYSTEM ============ let sparkleCanvas = null; let sparkleCtx = null; let sparkleActive = false; let sparkleAnimationId = null; const MAX_SPARKLES = 80; let sparkles = []; function hexToRgb(hex) { const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex); return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : { r: 255, g: 255, b: 255 }; } function getThemeColors() { const style = getComputedStyle(document.body); const themeColor = style.getPropertyValue('--theme-color').trim() || '#6366f1'; const themeColorLight = style.getPropertyValue('--theme-color-light').trim() || '#818cf8'; return [ '#FFFFFF', '#FFFEF0', themeColor, themeColorLight, '#FFD700', '#FFEC8B', '#E0FFFF', '#FFB6C1', '#98FB98', ]; } function createSparkle(w, h, colors, isInitial = false) { const color = colors[Math.floor(Math.random() * colors.length)]; const rgb = hexToRgb(color); const type = Math.random();


        let sparkle = {
            x: Math.random() * w,
            y: isInitial ? Math.random() * h : h + 20,
            vx: (Math.random() - 0.5) * 1.5,
            vy: -(Math.random() * 2 + 1),
            size: Math.random() * 4 + 2,
            opacity: 1,
            color: `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 1)`,
            rgb: rgb,
            rotation: Math.random() * 360,
            rotationSpeed: (Math.random() - 0.5) * 5,
            type: type < 0.4 ? 'star' : type < 0.7 ? 'circle' : 'diamond',
            pulsePhase: Math.random() * Math.PI * 2,
            pulseSpeed: Math.random() * 0.1 + 0.05,
            trail: [],
            maxTrail: Math.floor(Math.random() * 5) + 3
        };
        
        return sparkle;
    }
    function initSparkles(w, h) {
        sparkles = [];
        const colors = getThemeColors();
        
        for (let i = 0; i < MAX_SPARKLES; i++) {
            sparkles.push(createSparkle(w, h, colors, true));
        }
    }
    function createSparkle(w, h, colors, isInitial = false) {
    const color = colors[Math.floor(Math.random() * colors.length)];
    const rgb = hexToRgb(color);
    const type = Math.random();

    return {
        x: Math.random() * w,
        // —Ç–µ–ø–µ—Ä—å —Å–ø–∞–≤–Ω —Å–≤–µ—Ä—Ö—É
        y: isInitial ? Math.random() * h : -20,

        // –º–µ–¥–ª–µ–Ω–Ω–µ–µ –∏ –º—è–≥—á–µ
        vx: (Math.random() - 0.5) * 0.35,
        vy: (Math.random() * 0.6 + 0.35), // –≤–Ω–∏–∑

        size: Math.random() * 3 + 1.5,
        opacity: Math.random() * 0.35 + 0.65,

        color: `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 1)`,
        rgb,

        rotation: Math.random() * 360,
        rotationSpeed: (Math.random() - 0.5) * 1.2, // –ø–ª–∞–≤–Ω–µ–µ –≤—Ä–∞—â–µ–Ω–∏–µ

        type: type < 0.4 ? 'star' : type < 0.7 ? 'circle' : 'diamond',

        pulsePhase: Math.random() * Math.PI * 2,
        pulseSpeed: Math.random() * 0.03 + 0.01, // –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—É–ª—å—Å–∞—Ü–∏—è

        trail: [],
        maxTrail: Math.floor(Math.random() * 4) + 2
    };
}
    function drawStar(ctx, x, y, size, rotation) {
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(rotation * Math.PI / 180);
        
        const spikes = 4;
        const outerRadius = size;
        const innerRadius = size * 0.4;
        
        ctx.beginPath();
        for (let i = 0; i < spikes * 2; i++) {
            const radius = i % 2 === 0 ? outerRadius : innerRadius;
            const angle = (i * Math.PI) / spikes - Math.PI / 2;
            const px = Math.cos(angle) * radius;
            const py = Math.sin(angle) * radius;
            if (i === 0) ctx.moveTo(px, py);
            else ctx.lineTo(px, py);
        }
        ctx.closePath();
        ctx.fill();
        
        ctx.restore();
    }
    function drawDiamond(ctx, x, y, size, rotation) {
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(rotation * Math.PI / 180);
        
        ctx.beginPath();
        ctx.moveTo(0, -size);
        ctx.lineTo(size * 0.6, 0);
        ctx.lineTo(0, size);
        ctx.lineTo(-size * 0.6, 0);
        ctx.closePath();
        ctx.fill();
        
        ctx.restore();
    }
    function startSparkleEffect() {
        sparkleCanvas = createSparkleCanvas();
        if (!sparkleCanvas) return;
        
        sparkleCtx = sparkleCanvas.getContext('2d', { alpha: true });
        sparkleActive = true;
        
        initSparkles(sparkleCanvas.width, sparkleCanvas.height);
        animateSparkles();
    }
    function animateSparkles() {
        if (!sparkleCtx || !sparkleCanvas || !sparkleActive) return;
        
        const ctx = sparkleCtx;
        const w = sparkleCanvas.width;
        const h = sparkleCanvas.height;
        const colors = getThemeColors();
        
        ctx.clearRect(0, 0, w, h);
        
        for (let i = sparkles.length - 1; i >= 0; i--) {
            const s = sparkles[i];
            
            // Store trail position
            s.trail.unshift({ x: s.x, y: s.y, opacity: s.opacity * 0.5 });
            if (s.trail.length > s.maxTrail) s.trail.pop();
            
            // Physics
            // Physics (–ø–∞–¥–µ–Ω–∏–µ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑)
s.x += s.vx;
s.y += s.vy;

// –æ—á–µ–Ω—å –º—è–≥–∫–æ–µ "—É—Å–∫–æ—Ä–µ–Ω–∏–µ" –≤–Ω–∏–∑
s.vy += 0.003;

// –ª—ë–≥–∫–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ (–ø–ª–∞–≤–Ω–µ–µ)
s.vx *= 0.995;
s.vy *= 0.999;

s.rotation += s.rotationSpeed;
s.pulsePhase += s.pulseSpeed;

// Pulse effect
const pulse = Math.sin(s.pulsePhase) * 0.25 + 1;
const currentSize = s.size * pulse;

// –ü–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —É –Ω–∏–∑–∞ –∏ –ø–æ –∫—Ä–∞—è–º
if (s.y > h - 30) s.opacity -= 0.015;
if (s.x < 15 || s.x > w - 15) s.opacity -= 0.01;

// Remove dead sparkles (—Ç–µ–ø–µ—Ä—å —É–¥–∞–ª—è–µ–º, –∫–æ–≥–¥–∞ —É—à–ª–∏ –≤–Ω–∏–∑)
if (s.opacity <= 0 || s.y > h + 30) {
    sparkles.splice(i, 1);
    // —Å–ø–∞–≤–Ω–∏–º —Å–Ω–æ–≤–∞ —Å–≤–µ—Ä—Ö—É
    sparkles.push(createSparkle(w, h, colors, false));
    continue;
}
            // Draw trail
            for (let t = 0; t < s.trail.length; t++) {
                const trail = s.trail[t];
                const trailOpacity = trail.opacity * (1 - t / s.trail.length) * 0.3;
                const trailSize = currentSize * (1 - t / s.trail.length) * 0.5;
                
                ctx.globalAlpha = trailOpacity;
                ctx.fillStyle = `rgba(${s.rgb.r}, ${s.rgb.g}, ${s.rgb.b}, 1)`;
                ctx.beginPath();
                ctx.arc(trail.x, trail.y, trailSize, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Draw main sparkle
            ctx.globalAlpha = s.opacity;
            ctx.fillStyle = s.color;
            
            // Glow effect
            ctx.shadowColor = s.color;
            ctx.shadowBlur = currentSize * 3;
            
            if (s.type === 'star') {
                drawStar(ctx, s.x, s.y, currentSize, s.rotation);
            } else if (s.type === 'diamond') {
                drawDiamond(ctx, s.x, s.y, currentSize, s.rotation);
            } else {
                ctx.beginPath();
                ctx.arc(s.x, s.y, currentSize, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.shadowBlur = 0;
        }
        
        ctx.globalAlpha = 1;
        
        if (sparkleActive) {
            sparkleAnimationId = requestAnimationFrame(animateSparkles);
        }
    }
    function stopSparkleEffect() {
        sparkleActive = false;
        
        if (sparkleAnimationId) {
            cancelAnimationFrame(sparkleAnimationId);
            sparkleAnimationId = null;
        }
        
        if (sparkleCanvas) {
            sparkleCanvas.remove();
            sparkleCanvas = null;
        }
        sparkleCtx = null;
        sparkles = [];
    }
    // ============ HELPERS ============
    function getExpensivePrizeForCase() {
        const caseId = STATE.selectedCase?.id || 'cosmic';
        const expensivePrizes = {
            cosmic: [PRIZE_VISUALS[50], PRIZE_VISUALS[75], PRIZE_VISUALS[100]],
            stellar: [PRIZE_VISUALS[100], PRIZE_VISUALS[150], PRIZE_VISUALS[250]],
            golden: [PRIZE_VISUALS[250], PRIZE_VISUALS[500], PRIZE_VISUALS[150]],
            divine: [PRIZE_VISUALS[500], PRIZE_VISUALS[1000], PRIZE_VISUALS[9999]]
        };
        const prizes = expensivePrizes[caseId] || expensivePrizes.cosmic;
        const rand = Math.random();
        if (rand < 0.5) return prizes[0];
        if (rand < 0.8) return prizes[1];
        return prizes[2];
    }
    function getNonZeroPrizeForDisplay() {
        const caseId = STATE.selectedCase?.id || 'cosmic';
        const prizePools = {
            cosmic: [
                { prize: PRIZE_VISUALS[15], weight: 25 },
                { prize: PRIZE_VISUALS[25], weight: 25 },
                { prize: PRIZE_VISUALS[50], weight: 20 },
                { prize: PRIZE_VISUALS[75], weight: 18 },
                { prize: PRIZE_VISUALS[100], weight: 12 }
            ],
            stellar: [
                { prize: PRIZE_VISUALS[25], weight: 18 },
                { prize: PRIZE_VISUALS[50], weight: 18 },
                { prize: PRIZE_VISUALS[75], weight: 18 },
                { prize: PRIZE_VISUALS[100], weight: 18 },
                { prize: PRIZE_VISUALS[150], weight: 15 },
                { prize: PRIZE_VISUALS[250], weight: 13 }
            ],
            golden: [
                { prize: PRIZE_VISUALS[75], weight: 22 },
                { prize: PRIZE_VISUALS[100], weight: 22 },
                { prize: PRIZE_VISUALS[150], weight: 22 },
                { prize: PRIZE_VISUALS[250], weight: 20 },
                { prize: PRIZE_VISUALS[500], weight: 14 }
            ],
            divine: [
                { prize: PRIZE_VISUALS[100], weight: 18 },
                { prize: PRIZE_VISUALS[150], weight: 18 },
                { prize: PRIZE_VISUALS[250], weight: 18 },
                { prize: PRIZE_VISUALS[500], weight: 18 },
                { prize: PRIZE_VISUALS[1000], weight: 18 },
                { prize: PRIZE_VISUALS[9999], weight: 10 }
            ]
        };
        const pool = prizePools[caseId] || prizePools.cosmic;
        const totalWeight = pool.reduce((sum, p) => sum + p.weight, 0);
        let rand = Math.random() * totalWeight;
        for (const item of pool) {
            rand -= item.weight;
            if (rand <= 0) return item.prize;
        }
        return pool[0].prize;
    }
    function getItemWidth() {
        const screenWidth = window.innerWidth;
        if (screenWidth <= 380) return 97;
        if (screenWidth <= 390) return 102;
        return 112;
    }
    let ITEM_WIDTH = getItemWidth();
    const VISIBLE_ITEMS = isMobile ? 40 : 50;
    window.addEventListener('resize', () => { ITEM_WIDTH = getItemWidth(); });
    // ============ API ============
    async function apiRequest(path, options = {}) {
        if (DEMO_MODE) {
            // Simulate API responses in demo mode
            return simulateApiResponse(path, options);
        }
        
        const res = await fetch(API_BASE + path, {
            ...options,
            headers: {
                "Content-Type": "application/json",
                "X-Telegram-Init-Data": initData,
                ...(options.headers || {})
            }
        });
        const data = await res.json();
        if (!res.ok || data.success === false) {
            throw new Error(data.error || "API error");
        }
        return data;
    }
    function simulateApiResponse(path, options) {
        return new Promise(resolve => {
            setTimeout(() => {
                if (path === '/api/balance') {
                    resolve({
                        sapphires: STATE.sapphires || 5000,
                        stars: STATE.stars || 0,
                        can_spin: true
                    });
                } else if (path === '/api/spin') {
                    resolve({ success: true });
                } else if (path === '/api/claim') {
                    const body = JSON.parse(options.body || '{}');
                    const starsWon = body.stars || 0;
                    resolve({
                        new_sapphires: STATE.sapphires,
                        new_stars: STATE.stars + starsWon,
                        can_spin: true
                    });
                }
            }, 100);
        });
    }
    async function loadBalance() {
        try {
            if (DEMO_MODE) {
                STATE.sapphires = 5000;
                STATE.stars = 0;
                STATE.canSpin = true;
                updateUI();
                return true;
            }
            
            const data = await apiRequest("/api/balance");
            STATE.sapphires = data.sapphires;
            STATE.stars = data.stars;
            STATE.canSpin = data.can_spin;
            updateUI();
            return true;
        } catch (e) {
            console.error("Balance error:", e);
            if (DEMO_MODE) {
                STATE.sapphires = 5000;
                STATE.stars = 0;
                STATE.canSpin = true;
                updateUI();
                return true;
            }
            showFatalError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–ª–∞–Ω—Å–∞:\n" + e.message);
            return false;
        }
    }
    // ============ INIT ============
    async function init() {
        if (DEMO_MODE) {
            document.getElementById('demoBadge').style.display = 'inline-block';
            STATE.userId = 'demo_user';
            STATE.username = 'demo';
            STATE.sapphires = 5000;
            STATE.stars = 0;
            STATE.canSpin = true;
        } else {
            if (tg) {
                tg.ready();
                tg.expand();
                if (tg.initDataUnsafe?.user) {
                    STATE.userId = tg.initDataUnsafe.user.id;
                    STATE.username = tg.initDataUnsafe.user.username || '';
                }
                tg.BackButton.show();
                tg.BackButton.onClick(() => handleBackButton());
            }
        }
        generateStars();
        generateCasesGrid();
        preloadImages();
        const balanceLoaded = await loadBalance();
        if (!balanceLoaded && !DEMO_MODE) return;
        STATE.isInitialized = true;
        setTimeout(() => { document.getElementById('loadingOverlay').classList.add('hidden'); }, 400);
        updateSessionInfo();
    }
    function preloadImages() {
        const imageUrls = [];
        CASES.forEach(c => { if (c.image) imageUrls.push(c.image); });
        Object.values(PRIZE_VISUALS).forEach(p => { if (p.image) imageUrls.push(p.image); });
        imageUrls.forEach(url => { const img = new Image(); img.src = url; });
    }
    function generateCasesGrid() {
        const grid = document.getElementById('casesGrid');
        grid.innerHTML = CASES.map(caseItem => `
            <div class="case-card ${caseItem.style}" onclick="selectCase('${caseItem.id}')">
                <div class="case-card-bg"></div>
                <div class="case-card-glow"></div>
                ${caseItem.tag ? `<div class="case-card-tag">${caseItem.tag}</div>` : ''}
                <div class="case-card-image-container">
                    <img src="${caseItem.image}" alt="${caseItem.name}" class="case-card-image" loading="lazy" onerror="this.style.display='none'">
                </div>
                <div class="case-card-name">${caseItem.name}</div>
                <div class="case-card-price">
                    <span class="case-card-price-text">${caseItem.cost}</span>
                </div>
            </div>
        `).join('');
    }
    function selectCase(caseId) {
        const selectedCase = CASES.find(c => c.id === caseId);
        if (!selectedCase) return;
        STATE.selectedCase = selectedCase;
        STATE.spinCost = selectedCase.cost;
        document.body.className = selectedCase.theme;
        const emojiEl = document.getElementById('currentCaseEmoji');
        const imageEl = document.getElementById('currentCaseImage');
        if (selectedCase.image) {
            emojiEl.classList.add('hidden');
            imageEl.classList.remove('hidden');
            imageEl.src = selectedCase.image;
        } else {
            imageEl.classList.add('hidden');
            emojiEl.classList.remove('hidden');
        }
        document.getElementById('currentCaseName').textContent = selectedCase.name;
        document.getElementById('spinCost').textContent = selectedCase.cost;
        showScreen('case');
        generateItemsStrip();
        generatePrizesGrid();
        updateUI();
        haptic('impact');
    }
    function showScreen(screen) {
        STATE.currentScreen = screen;
        const menuScreen = document.getElementById('menuScreen');
        const caseScreen = document.getElementById('caseScreen');
        if (screen === 'menu') {
            menuScreen.classList.remove('hidden');
            caseScreen.classList.add('hidden');
            document.body.className = '';
        } else {
            menuScreen.classList.add('hidden');
            caseScreen.classList.remove('hidden');
        }
    }
    function goToMenu() {
        closeModal();
        showScreen('menu');
        STATE.selectedCase = null;
        haptic('selection');
    }
    function handleBackButton() {
        if (STATE.isModalOpen) closeModal();
        else if (STATE.currentScreen === 'case') goToMenu();
        else if (tg?.close) tg.close();
    }
    function generatePrizesGrid() {
        const grid = document.getElementById('prizesGrid');
        const caseId = STATE.selectedCase?.id || 'cosmic';
        const config = CASE_CONFIG[caseId];
        const displayPrizes = config.prizes.filter(s => s > 0).sort((a, b) => b - a).map(stars => PRIZE_VISUALS[stars]);
        displayPrizes.push(PRIZE_VISUALS[0]);
        grid.className = 'prizes-grid';
        const count = displayPrizes.length;
        if (count <= 5) grid.classList.add('cols-' + count);
        else if (count === 6) grid.classList.add('cols-6');
        else grid.classList.add('cols-7');
        grid.innerHTML = displayPrizes.map(prize => `
            <div class="prize-card ${prize.stars === 0 ? 'empty' : 'stars-' + prize.stars}">
                <div class="prize-card-visual">
                    <img src="${prize.image}" alt="${prize.name}" class="prize-card-image" loading="lazy" onerror="this.style.display='none'">
                </div>
                <div class="prize-card-name">${prize.stars === 0 ? '–ü—É—Å—Ç–æ' : prize.stars}</div>
            </div>
        `).join('');
    }
    function showFatalError(message) {
        document.getElementById('loadingOverlay').innerHTML = `
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 3rem; margin-bottom: 20px;">‚ùå</div>
                <div style="color: #ef4444; font-size: 1.1rem; font-weight: 600; margin-bottom: 10px;">–û—à–∏–±–∫–∞</div>
                <div style="color: #a1a1aa; font-size: 0.9rem; white-space: pre-wrap;">${message}</div>
                <button onclick="window.location.reload()" style="margin-top: 20px; background: linear-gradient(135deg, #6366f1, #4338ca); border: none; padding: 12px 24px; color: white; border-radius: 12px; font-weight: 600; cursor: pointer;">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            </div>
        `;
    }
    function getRandomPrize() {
        const caseId = STATE.selectedCase?.id || 'cosmic';
        return CASE_CONFIG[caseId].getRandomPrize();
    }
    function generateItemsStrip(winningPrize = null, winningIndex = null) {
        const strip = document.getElementById('itemsStrip');
        strip.innerHTML = '';
        strip.classList.remove('animating');
        strip.style.transform = 'translateX(0)';
        const fragment = document.createDocumentFragment();
        let prevWasZero = false;
        
        for (let i = 0; i < VISIBLE_ITEMS; i++) {
            let prize;
            if (winningIndex !== null && i === winningIndex) {
                prize = winningPrize;
                prevWasZero = (prize.stars === 0);
            } else if (winningIndex !== null && Math.abs(i - winningIndex) === 1 && winningPrize && winningPrize.stars === 0) {
                prize = getExpensivePrizeForCase();
                prevWasZero = false;
            } else if (winningIndex !== null && Math.abs(i - winningIndex) === 2 && winningPrize && winningPrize.stars === 0) {
                prize = getNonZeroPrizeForDisplay();
                prevWasZero = false;
            } else {
                const shouldBeZero = Math.random() < 0.2;
                if (shouldBeZero && !prevWasZero) {
                    prize = PRIZE_VISUALS[0];
                    prevWasZero = true;
                } else {
                    prize = getNonZeroPrizeForDisplay();
                    prevWasZero = false;
                }
            }
            const item = document.createElement('div');
            item.className = `prize-item rarity-${prize.rarity}`;
            if (prize.image) item.classList.add('has-image');
            item.dataset.index = i;
            item.dataset.stars = prize.stars;
            if (prize.image) {
                const img = document.createElement('img');
                img.src = prize.image;
                img.alt = '';
                img.className = 'prize-image';
                img.loading = 'eager';
                item.appendChild(img);
            }
            fragment.appendChild(item);
        }
        strip.appendChild(fragment);
    }
    async function runAnimation(winningPrize) {
        const winningIndex = 30 + Math.floor(Math.random() * 5);
        generateItemsStrip(winningPrize, winningIndex);
        const container = document.getElementById('caseContainer');
        const strip = document.getElementById('itemsStrip');
        const containerWidth = container.offsetWidth;
        const centerPosition = containerWidth / 2;
        const targetPosition = (winningIndex * ITEM_WIDTH) + (ITEM_WIDTH / 2) - centerPosition;
        
        let randomOffset = (Math.random() - 0.5) * 20;
        const finalPosition = targetPosition + randomOffset;
        strip.style.transform = `translateX(${containerWidth}px)`;
        strip.offsetHeight;
        requestAnimationFrame(() => {
            strip.classList.add('animating');
            strip.style.transform = `translateX(-${finalPosition}px)`;
        });
        if (!isMobile) {
            playTickSounds();
        } else {
            setTimeout(() => haptic('selection'), 500);
            setTimeout(() => haptic('selection'), 2000);
            setTimeout(() => haptic('selection'), 4000);
        }
        await new Promise(resolve => setTimeout(resolve, 5100));
        const winnerItem = strip.querySelector(`[data-index="${winningIndex}"]`);
        if (winnerItem) winnerItem.classList.add('winner');
    }
    async function openCase() {
        if (isSpinning || STATE.isModalOpen) return;
        const currentCost = STATE.selectedCase?.cost || STATE.spinCost;
        if (STATE.sapphires < currentCost) {
            showStatus('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∞–ø—Ñ–∏—Ä–æ–≤!', 'error');
            haptic('error');
            return;
        }
        isSpinning = true;
        hideStatus();
        document.getElementById('spinBtn').disabled = true;
        haptic('impact');
        const prizeStars = getRandomPrize();
        const prize = PRIZE_VISUALS[prizeStars] || PRIZE_VISUALS[0];
        STATE.sapphires -= currentCost;
        STATE.spinsCount++;
        updateUI();
        const animationPromise = runAnimation(prize);
        
        let spinSuccess = false;
        const spinPromise = (async () => {
            try {
                await apiRequest("/api/spin", {
                    method: "POST",
                    body: JSON.stringify({ cost: currentCost, case_id: STATE.selectedCase?.id || 'cosmic' })
                });
                spinSuccess = true;
            } catch (e) {
                console.error("Spin error:", e);
                if (!DEMO_MODE) {
                    showStatus('–û—à–∏–±–∫–∞: ' + e.message, 'error');
                    haptic('error');
                    await loadBalance();
                } else {
                    spinSuccess = true;
                }
            }
        })();
        await Promise.all([animationPromise, spinPromise]);
        let apiSuccess = false;
        if (spinSuccess) {
            try {
                const claimData = await apiRequest("/api/claim", {
                    method: "POST",
                    body: JSON.stringify({
                        stars: prizeStars,
                        case_id: STATE.selectedCase?.id || 'cosmic'
                    })
                });
                STATE.sapphires = claimData.new_sapphires;
                STATE.stars = claimData.new_stars;
                STATE.canSpin = claimData.can_spin;
                if (prizeStars > 0) STATE.totalWon += prizeStars;
                apiSuccess = true;
                updateUI();
            } catch (e) {
                console.error("Claim error:", e);
                if (!DEMO_MODE) {
                    showStatus('–û—à–∏–±–∫–∞: ' + e.message, 'error');
                    haptic('error');
                    await loadBalance();
                } else {
                    STATE.stars += prizeStars;
                    if (prizeStars > 0) STATE.totalWon += prizeStars;
                    apiSuccess = true;
                    updateUI();
                }
            }
        }
        if (apiSuccess) {
            showResult(prize);
        }
        isSpinning = false;
        updateSessionInfo();
    }
    function playTickSounds() {
        let tickCount = 0;
        const maxTicks = 35;
        const tickInterval = setInterval(() => {
            tickCount++;
            if (tickCount > maxTicks) {
                clearInterval(tickInterval);
                return;
            }
            if (tickCount < 18) haptic('selection');
        }, 120);
    }
    function showResult(prize) {
        STATE.isModalOpen = true;
        document.getElementById('spinBtn').disabled = true;
        const overlay = document.getElementById('modalOverlay');
        const modal = document.getElementById('modal');
        const emoji = document.getElementById('modalEmoji');
        const title = document.getElementById('modalTitle');
        const prizeText = document.getElementById('modalPrize');
        const spinAgainBtn = document.getElementById('spinAgainBtn');
        stopSparkleEffect();
        modal.classList.remove('win', 'lose');
        if (prize.image) {
            emoji.innerHTML = `<img src="${prize.image}" class="modal-prize-image" onerror="this.style.display='none'">`;
        } else {
            emoji.innerHTML = '';
        }
        if (prize.stars > 0) {
            modal.classList.add('win');
            
            if (prize.stars >= 9999) {
                title.textContent = '–î–ñ–ï–ö–ü–û–¢!';
            } else if (prize.stars >= 1000) {
                title.textContent = '–î–ñ–ï–ö–ü–û–¢!';
            } else if (prize.stars >= 500) {
                title.textContent = '–ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ!';
            } else if (prize.stars >= 100) {
                title.textContent = '–û—Ç–ª–∏—á–Ω–æ!';
            } else {
                title.textContent = '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!';
            }
            
            prizeText.textContent = `+${prize.stars}`;
            haptic('success');
            
            // Start sparkle effect for wins
            setTimeout(() => startSparkleEffect(), 100);
        } else {
            modal.classList.add('lose');
            title.textContent = '–ü—É—Å—Ç–æ...';
            prizeText.textContent = '–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!';
            haptic('error');
        }
        document.getElementById('modalSapphires').textContent = STATE.sapphires;
        document.getElementById('modalStars').textContent = STATE.stars;
        const canSpinAgain = STATE.sapphires >= STATE.spinCost && STATE.canSpin;
        spinAgainBtn.style.display = canSpinAgain ? 'block' : 'none';
        overlay.classList.add('show');
    }
    function spinAgain() {
        closeModal();
        requestAnimationFrame(() => {
            generateItemsStrip();
            openCase();
        });
    }
    function closeModal() {
        STATE.isModalOpen = false;
        stopSparkleEffect();
        document.getElementById('modalOverlay').classList.remove('show');
        document.getElementById('modal').classList.remove('win', 'lose');
        updateUI();
    }
    function updateUI() {
        const sapphiresEl = document.getElementById('sapphires');
        const starsEl = document.getElementById('stars-balance');
        
        const oldSapphires = parseInt(sapphiresEl.textContent) || 0;
        const oldStars = parseInt(starsEl.textContent) || 0;
        
        sapphiresEl.textContent = STATE.sapphires;
        starsEl.textContent = STATE.stars;
        
        if (oldSapphires !== STATE.sapphires) {
            sapphiresEl.classList.add('updated');
            setTimeout(() => sapphiresEl.classList.remove('updated'), 400);
        }
        if (oldStars !== STATE.stars) {
            starsEl.classList.add('updated');
            setTimeout(() => starsEl.classList.remove('updated'), 400);
        }
        const canSpin = STATE.sapphires >= STATE.spinCost &&
                       !isSpinning &&
                       !STATE.isModalOpen &&
                       STATE.canSpin !== false;
        document.getElementById('spinBtn').disabled = !canSpin;
    }
    function updateSessionInfo() {
        const modeText = DEMO_MODE ? 'DEMO' : 'LIVE';
        document.getElementById('sessionInfo').textContent =
            `${modeText} | ID:${STATE.userId || '?'} | Spins:${STATE.spinsCount} | Won:${STATE.totalWon}`;
    }
    function showStatus(message, type = 'error') {
        const el = document.getElementById('statusMessage');
        el.innerHTML = message;
        el.className = `status-message show ${type === 'success' ? 'success' : ''}`;
        setTimeout(() => hideStatus(), 4000);
    }
    function hideStatus() {
        document.getElementById('statusMessage').classList.remove('show');
    }
    function generateStars() {
        const container = document.getElementById('bgStars');
        const starCount = isMobile ? 60 : 100;
        const fragment = document.createDocumentFragment();
        for (let i = 0; i < starCount; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            const size = Math.random() * 2.5 + 0.5;
            const isBig = size > 2;
            if (isBig) star.classList.add('big');
            
            star.style.cssText = `
                left: ${Math.random() * 100}%;
                top: ${Math.random() * 100}%;
                opacity: ${Math.random() * 0.5 + 0.2};
                width: ${size}px;
                height: ${size}px;
                animation-delay: ${Math.random() * 3}s;
                animation-duration: ${2 + Math.random() * 2}s;
            `;
            fragment.appendChild(star);
        }
        container.appendChild(fragment);
    }
    function haptic(type) {
        if (tg?.HapticFeedback) {
            try {
                if (type === 'success') tg.HapticFeedback.notificationOccurred('success');
                else if (type === 'error') tg.HapticFeedback.notificationOccurred('error');
                else if (type === 'impact') tg.HapticFeedback.impactOccurred('heavy');
                else if (type === 'selection') tg.HapticFeedback.selectionChanged();
            } catch (e) {}
        }
    }
    // ============ EVENT LISTENERS ============
    document.addEventListener('DOMContentLoaded', init);
    document.getElementById('modalOverlay').addEventListener('click', (e) => {
        if (e.target.id === 'modalOverlay') closeModal();
    });
    if (!isMobile) {
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && !isSpinning && !STATE.isModalOpen && STATE.currentScreen === 'case') {
                e.preventDefault();
                openCase();
            }
            if (e.code === 'Escape') handleBackButton();
        });
    }
    let lastTouchEnd = 0;
    document.addEventListener('touchend', (e) => {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) e.preventDefault();
        lastTouchEnd = now;
    }, { passive: false });
    document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
            document.body.classList.add('paused');
            stopSparkleEffect();
        } else {
            document.body.classList.remove('paused');
            if (STATE.isModalOpen && document.getElementById('modal').classList.contains('win')) {
                startSparkleEffect();
            }
        }
    });
</script>

</body> </html>
